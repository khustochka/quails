- use_jquery
- javascript JQ_UI_FILE, 'suggest_over_combo'
- stylesheet 'autocomplete', 'forms'

- @page_title = 'Observations'

%h1 Search observations

= simple_form_for @search, :url => observations_path, :method => :get do |form|
  = form.input :species_id_eq, :label => 'Species:', :collection => species_for_select,
      :label_method => :name_sci, :input_html => {:class => 'suggest-combo'}
  = form.input :observ_date_eq, :label => 'Date:', :input_html => {:class => 'short', :maxlength => 10}
  = form.input :locus_id_eq, :label => 'Location:', :collection => Locus.all_ordered, :label_method => :name_en,
      :input_html => {:class => 'suggest-combo'}
  %div.input.optional.mine_eq_select
    = form.collection_radio :mine_eq, [['', 'All'], [true, 'Mine'], [false, 'Not mine']], :first, :last
  .buttons
    = form.button :submit, :value => 'Search', :name => nil

%table.neat_table.obs_list
  %tr
    %th.align-right ID
    %th= link_to_unless_current('Species ⇓', params.merge({:sort => 'species.index_num', :page => nil}))
    %th Location
    %th.align-center= link_to_unless_current('Date ⇓', params.merge({:sort => :observ_date, :page => nil}))
    %th Quantity
    %th Biotope
    %th Place
    %th Notes
    %th Post
    %th.align-center= link_to_unless_current('Mine ⇓', params.merge({:sort => 'mine DESC', :page => nil}))
    %th

  - @observations.each do |observation|
    - blogpost = observation.post
    %tr
      %td.align-right= link_to observation.id, edit_observation_path(observation)
      %td.nowrap= name_sci(observation.species)
      %td= observation.locus.name_en || observation.locus.code
      %td.align-center.nowrap= observation.observ_date
      %td= observation.quantity
      %td= observation.biotope
      %td= observation.place
      %td= observation.notes
      %td= post_link('>>', blogpost)
      %td.align-center= observation.mine ? '+' : '-'
      %td= link_to image_tag('x_alt_16x16.png', :title => 'Destroy'), observation, :confirm => 'Are you sure?', :method => :delete

= paginate @observations
