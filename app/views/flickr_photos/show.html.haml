- stylesheet 'forms'
- javascript 'image_flickr'

- @page_title = [@image.on_flickr? ? 'Flickred' : 'Unflickred', @image.formatted.title].join(": ")

%h1= page_header

%ul.horiz-list
  %li= link_to('Show', image_path(@image))
  %li= link_to('Edit', edit_image_path(@image))
  %li= link_to('Map', edit_map_image_path(@image))

%p
  - if @image.on_flickr?
    This image is linked to flickr photo
    = link_to nil, "http://www.flickr.com/photos/#{Settings.flickr_admin.user_id}/#{@image.flickr_id}/"
    = form_tag({action: :patch}, method: 'post') do
      = hidden_field_tag 'image[flickr_id]', nil
      = submit_tag "Detach"
  - else
    This image is not linked to flickr photo.
    = form_tag flickr_photos_path do
      = hidden_field_tag("id", @image.slug)
      = hidden_field_tag("public", "0")
      %div.input.flat
        %label
          = check_box_tag 'public', 1, true
          Public
        = submit_tag("Upload to flickr")


%h3 Find a picture:

%table.with_search.flickr_search_table.with_search
  %tr
    %td{rowspan: 2, valign: 'top'}
      = image_tag(thumbnail_item(@image).try(:full_url), class: 'image_pic')
      = simple_form_for @image,url: patch_image_path(@image, :json), remote: true, method: :post, html: {class: 'flickr_edit'} do |form|
        = form.input :flickr_id, as: :hidden
    %td.flickr_search
      - if FlickrApp.configured?
        %input.string.short#flickr_user_id{name: 'flickr_user_id', type: 'hidden', value: Settings.flickr_admin.user_id}
        %div.input.string
          %label.string Text:
          %input.string#flickr_text{name: 'flickr_text', type: 'text', value: @image.species.map(&:name_sci).join(' ')}
        %div.input.string
          %label.string Date:
          %input.string.short#flickr_date{name: 'flickr_date', maxlength: '10', type: 'date', value: @image.observ_date}
        %button.flickr_search_btn{type: 'button'} Search
      - else
        %div.errors No Flickr API key or secret defined!
  %tr
    %td.found_pictures

= link_to("Next unflickred image >>", flickr_photo_path(@next), class: 'next_unflickred') if @next
