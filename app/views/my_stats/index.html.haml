-# no_viewport is for very wide pages, e.g. with table
- @no_viewport = true

- @special_styling = true

- @page_title = t('.title')

- @robots = 'NOINDEX'

- translated

%div.header-with-subheader
  %h1= @page_title

  %ul.subheader-menu
    %li= link_to('Lifelist', lifelist_path)
    %li= link_to(t('lists.title.ukraine'), list_path(locus: 'ukraine'))
    %li= link_to(t('lists.title.usa'), list_path(locus: 'usa'))
    %li= link_to(t('lists.title.gb'), list_path(locus: 'united_kingdom'))
    %li= link_to(t('lists.title.canada'), list_path(locus: 'canada'))

- cache(key: CacheKey.lifelist) do

  - first_sp_by_year = @first_sp_by_year.count(:all)
  - grouped_by_year_and_country = @grouped_by_year_and_country.count_distinct_species
  - grouped_by_country = @grouped_by_country.count_distinct_species

  %table.nice_stats
    %tr
      %th &nbsp;
      %th.count_sp
        = t('.species_met')
      %th.count_new
        = t('.lifers_met')
      %th &nbsp;

    - @year_data.count_distinct_species.each do |year, count_species|

      %tr
        %td.year= year

        %td.count_sp
          = link_to count_species, list_path(year: year)

        %td.count_new<>
          - new_sp = first_sp_by_year[year.to_i]
          - if new_sp && new_sp > 0
            -#\/
            %small<>
              = link_to advanced_list_path(anchor: "first_seen_#{year}") do
                =  new_sp

        %td.countries
          %ul
            - @countries.each do |c|
              - count = grouped_by_year_and_country[[year, c.id]]
              - if count
                %li{class: c.slug}
                  = succeed ':' do
                    = c.name
                  %span.count= link_to count, list_path(year: year, locus: c.slug)

    %tr.total
      %td.year= t('.total')
      %td.count_sp= link_to MyObservation.count_distinct_species, lifelist_path
      %td
      %td.countries
        %ul
          - @countries.each do |c|
            - count = grouped_by_country[c.id]
            - if count
              %li{class: c.slug}
                = succeed ':' do
                  = c.name
                %span.count= link_to count, list_path(locus: c.slug)

  - day_with_max_species = Date.new(2016, 9, 3)
  - max_species_for_day = 64
  - post_for_day_with_max_species = show_post_path(2016, "10", "new-record")

  - day_with_max_new_species = Date.new(2010, 8, 14)
  - max_new_species_for_day = 15
  - post_for_day_with_max_new_species = show_post_path(2010, "08", "jamaica-bay-herons-et-al")

  %table.nice_stats.records
    %tr
      %th{colspan: 4}
        %h2= t('.records')

    %tr
      %td.day= link_to_if I18n.russian_locale? && post_for_day_with_max_species, l(day_with_max_species, format: :long), post_for_day_with_max_species
      %td.place Whitewater Lake WMA & Turtle Mountain Provincial Park, Manitoba, Canada
      %td.count_sp= max_species_for_day
      %td.count_sp_label= t('misc.species_count', count: max_species_for_day)

    %tr
      %td.day= link_to_if I18n.russian_locale?, l(day_with_max_new_species, format: :long), post_for_day_with_max_new_species
      %td.place Jamaica Bay Wildlife Refuge, New York City, USA
      %td.count_new_big= max_new_species_for_day
      %td.count_new_label
        = t('my_stats.index.new_count_species', count: max_new_species_for_day)
