- @page_title = "#{new_or_edit_label(@post)} post"

- javascript 'post_form'
- @js_features = [:wikiFields]

- stylesheet 'forms'

%h1= page_header

= render 'admin/shortcuts' if current_user.admin?

- if notice
  %p#notice= notice

- if alert
  %p.errors= alert

= simple_form_for @post do |form|

  %div
    = form.input :slug
    = form.input :face_date, label: 'Post date', input_html: {value: @post.face_date.strftime("%F %T")}, as: :string
  %div
    = form.input :title, input_html: {class: 'long', required: false}
  = form.input :text, label: false, input_html: {rows: 20, class: 'wiki_field'}
  %div
    = form.input :topic, collection: Post::TOPICS, input_html: {size: '3'}, include_blank: false
    = form.input :status, collection: Post::STATES, input_html: {size: '3'}, include_blank: false
  .buttons
    = default_submit_button(form)

- if @post.persisted?

  %p= default_destroy_button

  %h3#card_attach Attach cards

  = simple_form_for @observation_search, url: cards_path, method: :get, remote: true, html: {class: 'search'} do |form|
    = render 'observations/search_fields', form: form
    = hidden_field_tag("new_post_id", @post.id)

  %ul.cards_list#search-results

  %h3 Livejournal
  %ul
    %li#lj_url_li
      - if @post.lj_data.blank?
        Not yet on Livejournal
      - else
        = link_to(@post.lj_url, @post.lj_url)

    %li= button_to('Post to LJ', {action: :lj_post}, {form: {id: 'lj_post'}})
