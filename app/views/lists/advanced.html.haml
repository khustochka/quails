- @body_class = 'wider'

- @robots = 'NOINDEX'
- javascript 'lifelist'

- @page_title = capture do
  - if params[:month]
    = [ t('lists.title.monthlist', month: t('date.month_names')[params[:month].to_i]),
        params[:year] ? t('lists.title.yearsublist', year: params[:year]) : nil,
        params[:locus] ? "(#{@lifelist.locus.name})" : nil ] * ' '
  - elsif params[:year]
    = [t('lists.title.yearlist', year: params[:year]), params[:locus] ? "(#{@lifelist.locus.name})" : nil] * ' '
  - elsif params[:locus]
    = t('lists.title.locationlist', location: @lifelist.locus.name)
  - else
    = t('lists.title.lifelist')

- cache significant_params.merge(admin: current_user.admin?, key: CacheKey.lifelist, locale: I18n.locale) do

  = render partial: 'partials/translated', locals: {url: significant_params}

  %h1= page_header

  %div{data: {turbolinks: "true"}}

    = render "lists/menus"

    %ul.horiz-list.filter-list
      %strong= t('lists.menus.filter.months')
      %li= filtering_link_to_all(:month)
      - 1.upto(12) do |m|
        %li
          = link_to_or_span(t('date.abbr_month_names')[m], significant_params.merge(:month => m))

  - if @lifelist.blank?
    %p No species
  - else
    - sort = params[:sort]
    %table#lifelist.neat_table.advanced
      %thead{data: {turbolinks: "true"}}
        %tr
          %th.empty_cell &nbsp;
          %th
            %i.sort_by_label= t('lists.basic.filter.sort_by')
            = sorting_link_to(:class, "Classification")
          %th.align-center
            = sorting_link_to(nil, "First seen")
          %th.align-center
            = sorting_link_to(:last, "Last seen")
          %th.align-right.count-column-header
            = sorting_link_to(:count, "Count")
      %tbody
        = render sort.nil? || sort == 'last' ? "lists/advanced/by_date" : "lists/advanced/by_#{sort}"
